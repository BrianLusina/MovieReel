machine:
  pre:
    java:
      version: openjdk 7

  environment:
    QEMU_AUDIO_DRV: none
      
test:
  pre:
    # an AVD preinstalled on the machine for Android 24 on the ARM V7 EABI
    - emulator -avd circleci-android24 -no-window
      background: true
      parrallel: true

    # This waits for the emulator to finish booting, adb wait-for-device is not sufficient as it waits
    # for the shell to be available not for the boot process to complete
    - circle-android wait-for-boot

  override:
    # run tests against the emulator
    - ./gradlew testDebugUnitTestCoverage

    # copy the build outputs to artifacts
    - cp -r $PWD/build/outputs $CIRCLE_ARTIFACTS

    # copy the tests results to the tests results directory
    - cp -r app/build/outputs/androidTest-results/* $CIRCLE_TEST_REPORTS